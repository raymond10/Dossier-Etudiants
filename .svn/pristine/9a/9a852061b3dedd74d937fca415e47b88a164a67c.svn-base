/**
 * 
 */
package etudiants.utt.fr.components.controlers;

import com.webobjects.appserver.WOActionResults;
import com.webobjects.appserver.WOComponent;
import com.webobjects.appserver.WODisplayGroup;
import com.webobjects.appserver.WOSession;
import com.webobjects.eocontrol.EOEditingContext;
import com.webobjects.foundation.NSArray;
import com.webobjects.foundation.NSDictionary;
import com.webobjects.foundation.NSLog;
import com.webobjects.foundation.NSMutableArray;
import com.webobjects.foundation.NSMutableDictionary;

import er.extensions.eof.ERXEC;
import etudiants.utt.fr.components.DossierAdm;
import etudiants.utt.fr.components.EmploiDuTemps;
import etudiants.utt.fr.components.ProfilEtudiants;
import etudiants.utt.fr.components.ResultatsUV;
import etudiants.utt.fr.eo.EOIndividu;
import etudiants.utt.fr.roles.LeUser;
import etudiants.utt.fr.server.Session;
import etudiants.utt.fr.server.exception.FactoryException;
import etudiants.utt.fr.server.process.ProcessGestionEdt;
import etudiants.utt.fr.server.process.ProcessGestionEtudiant;
import etudiants.utt.fr.sql.RechercheSQL;
import etudiants.utt.fr.util.EdtUtilitaires;
import etudiants.utt.fr.util.RegEx;

/**
 * @author Raymond NANEON <raymond.naneon at utt.fr>
 * 
 */
@SuppressWarnings("all")
public class EmploiDuTempsCtrl extends AComponentCtrl {

	public Integer HEIGHT = 20;
	public Integer WEIGHT = 48;
	public EmploiDuTemps wocomponent;
	public EOEditingContext edc;
	public Session sess;
	private Boolean isAutorizUser;
	private Boolean isEtudiant;
	private LeUser user;
	public NSMutableDictionary unUser;
	private NSMutableDictionary publi;
	private NSMutableDictionary students;
	WODisplayGroup dg;
	NSDictionary bdgs;
	public static RechercheSQL sqli;
	public static ProcessGestionEdt gestEdt;
	private NSMutableDictionary edt;
	private NSMutableDictionary data;
	private NSMutableArray ttime;
	private String html;
	public NSArray etu;
	private Number id;
	private Number cid;
	String uv = null;
	Integer hei = 0;
	Integer wei = 0;
	String col = null;
	String tipe = null;
	String sale = null;
	String weak = null;
	public boolean publique = false;
	public NSMutableDictionary type;
	public NSMutableArray<String> jours;
	public NSMutableArray couleurs;
	private NSMutableDictionary couleur;
	private NSMutableArray horaire;
	private String horaireLoop;
	private String leHTML;
	public String tplVide = null;
	public String tplPlein = null;
	RegEx regex;
	private String nom;
	private String courante;

	public EmploiDuTempsCtrl(EmploiDuTemps aComponent) {
		// TODO Auto-generated constructor stub
		wocomponent = aComponent;
		type = wocomponent.getEdtUtil().theType();
		jours = wocomponent.getEdtUtil().theDay();
		couleurs = wocomponent.getEdtUtil().theColor();
		horaire = new NSMutableArray();
		regex = new RegEx();
		unUser = new NSMutableDictionary();
		data = new NSMutableDictionary();
		publi = new NSMutableDictionary();
		students = new NSMutableDictionary();
		couleur = new NSMutableDictionary();
		edt = new NSMutableDictionary();
		user = new LeUser();
		dg = new WODisplayGroup();
		bdgs = new NSDictionary();
		sqli = new RechercheSQL();
		gestEdt = new ProcessGestionEdt();
		etu = new NSArray();
		ttime = new NSMutableArray();
		id = 0;
		cid = 0;
		edc = wocomponent.edc();
		dg = wocomponent.getEtudiantActif();
		sess = wocomponent.mySession();
		user = wocomponent.user();
		unUser = user.getLeUser();
		NSMutableDictionary bindinds = new NSMutableDictionary();
		bindinds.put("numero", sess.getEtudiant().primaryKey());
		etu = reWriteListDico(sqli.getRawRowSearchEtudiants(edc, bindinds));
		publi = reWriteDico((NSMutableDictionary) gestEdt.selectRawRowEdtPubli(
				edc).lastObject());
		if (publi != null && publi.objectForKey("PUBLI").equals("O")
				&& data != null) {
			publique = true;
		} else {
			publique = false;
		}
		courante = (String) sess.getPeriodeCourante().objectForKey("LIBELLE");
	}

	/**
	 * @return the isAutorizUser
	 */
	public Boolean getIsAutorizUser() {
		isAutorizUser = (Boolean) unUser.valueForKey("isAutorized");
		return isAutorizUser;
	}

	/**
	 * @param isAutorizUser
	 *            the isAutorizUser to set
	 */
	public void setIsAutorizUser(Boolean isAutorizUser) {
		this.isAutorizUser = isAutorizUser;
	}

	/**
	 * @return the isEtudiant
	 */
	public Boolean getIsEtudiant() {
		isEtudiant = sess.getEtudiant().isNonNull() && isAutorizUser;
		return isEtudiant;
	}

	/**
	 * @param isEtudiant
	 *            the isEtudiant to set
	 */
	public void setIsEtudiant(Boolean isEtudiant) {
		this.isEtudiant = isEtudiant;
	}

	/**
	 * @return the user
	 */
	public LeUser getUser() {
		return user;
	}

	/**
	 * @param user
	 *            the user to set
	 */
	public void setUser(LeUser user) {
		this.user = user;
	}

	/**
	 * @return the publi
	 */
	public NSMutableDictionary getPubli() {
		return publi;
	}

	/**
	 * @param publi
	 *            the publi to set
	 */
	public void setPubli(NSMutableDictionary publi) {
		this.publi = publi;
	}

	/**
	 * @return the students
	 */
	public NSMutableDictionary getStudents() {
		return students;
	}

	/**
	 * @param students
	 *            the students to set
	 */
	public void setStudents(NSMutableDictionary students) {
		this.students = students;
	}

	/**
	 * @return the id
	 */
	public Number getId() {
		return id;
	}

	/**
	 * @param id
	 *            the id to set
	 */
	public void setId(Number id) {
		this.id = id;
	}

	/**
	 * @return the cid
	 */
	public Number getCid() {
		return cid;
	}

	/**
	 * @param cid
	 *            the cid to set
	 */
	public void setCid(Number cid) {
		this.cid = cid;
	}

	/**
	 * @return the edt
	 */
	public NSMutableDictionary getEdt() {
		return edt;
	}

	/**
	 * @param edt
	 *            the edt to set
	 */
	public void setEdt(NSMutableDictionary edt) {
		this.edt = edt;
	}

	/**
	 * @return the couleur
	 */
	public NSMutableDictionary getCouleur() {
		return couleur;
	}

	/**
	 * @param couleur
	 *            the couleur to set
	 */
	public void setCouleur(NSMutableDictionary couleur) {
		this.couleur = couleur;
	}

	/**
	 * @return the data
	 */
	public NSMutableDictionary getData() {
		return data;
	}

	/**
	 * @param data
	 *            the data to set
	 */
	public void setData(NSMutableDictionary data) {
		this.data = data;
	}

	/**
	 * @return the ttime
	 */
	public NSMutableArray getTtime() {
		return ttime;
	}

	/**
	 * @param ttime
	 *            the ttime to set
	 */
	public void setTtime(NSMutableArray ttime) {
		this.ttime = ttime;
	}

	/**
	 * @return the html
	 */
	public String getHtml() {
		return html;
	}

	/**
	 * @param html
	 *            the html to set
	 */
	public void setHtml(String html) {
		this.html = html;
	}

	/**
	 * @return the horaire
	 */
	public NSMutableArray getHoraire() {
		return horaire;
	}

	/**
	 * @param horaire
	 *            the horaire to set
	 */
	public void setHoraire(NSMutableArray horaire) {
		this.horaire = horaire;
	}

	/**
	 * @return the horaireLoop
	 */
	public String getHoraireLoop() {
		return horaireLoop;
	}

	/**
	 * @param horaireLoop
	 *            the horaireLoop to set
	 */
	public void setHoraireLoop(String horaireLoop) {
		this.horaireLoop = horaireLoop;
	}

	/**
	 * @return the leHTML
	 */
	public String getLeHTML() {
		return leHTML;
	}

	/**
	 * @param leHTML
	 *            the leHTML to set
	 */
	public void setLeHTML(String leHTML) {
		this.leHTML = leHTML;
	}

	/**
	 * @return the nom
	 */
	public String getNom() {
		return nom;
	}

	/**
	 * @param nom
	 *            the nom to set
	 */
	public void setNom(String nom) {
		this.nom = nom;
	}

	/**
	 * @return the prenom
	 */
	public String getCourante() {
		return courante;
	}

	/**
	 * @param prenom
	 *            the prenom to set
	 */
	public void setCourante(String courante) {
		this.courante = courante;
	}

	// Lien page etudiant
	public WOActionResults dossier() {
		sess.setRetourAlaListe(true);
		if (sess.dgActif() == null || sess.dgActif().allObjects().count() == 0) {
			sess.setRetourAlaListe(false);
		}
		sess.setEtudiant(sess.getEtudiant());
		DossierAdm dossierPage = (DossierAdm) wocomponent
				.pageWithName(DossierAdm.class.getName());
		EOEditingContext newEdc = ERXEC.newEditingContext();
		sess.setNestedEdc(newEdc);
		return dossierPage;
	}

	public WOActionResults leprofil() {
		sess.setRetourAlaListe(true);
		if (sess.dgActif() == null || sess.dgActif().allObjects().count() == 0) {
			sess.setRetourAlaListe(false);
		}
		if (etu != null && etu.count() != 0) {
			sess.setEtudiant(sess.getEtudiant());
		}
		ProfilEtudiants profilPage = (ProfilEtudiants) wocomponent
				.pageWithName(ProfilEtudiants.class.getName());
		EOEditingContext newEdc = ERXEC.newEditingContext();
		sess.setNestedEdc(newEdc);
		return profilPage;
	}

	public WOActionResults leResultatUv() {
		sess.setRetourAlaListe(true);
		if (sess.dgActif() == null || sess.dgActif().allObjects().count() == 0) {
			sess.setRetourAlaListe(false);
		}
		if (etu != null && etu.count() != 0) {
			sess.setEtudiant(sess.getEtudiant());
		}
		ResultatsUV resUvPage = (ResultatsUV) wocomponent
				.pageWithName(ResultatsUV.class.getName());
		EOEditingContext newEdc = ERXEC.newEditingContext();
		sess.setNestedEdc(newEdc);
		return resUvPage;
	}

	public WOActionResults lEmploiDuTemps() {
		sess.setRetourAlaListe(true);
		if (sess.dgActif() == null || sess.dgActif().allObjects().count() == 0) {
			sess.setRetourAlaListe(false);
		}
		if (etu != null && etu.count() != 0) {
			sess.setEtudiant(sess.getEtudiant());
		}
		EmploiDuTemps lEdtPage = (EmploiDuTemps) wocomponent
				.pageWithName(EmploiDuTemps.class.getName());
		EOEditingContext newEdc = ERXEC.newEditingContext();
		sess.setNestedEdc(newEdc);
		return lEdtPage;
	}

	// fin lien page etudiant

	public WOActionResults retourAlaListe() {
		WOComponent searchPage = null;
		NSArray<EOIndividu> lesEtudiants = new NSArray<EOIndividu>();
		WODisplayGroup dg = wocomponent.getDgActif();
		if (dg.allObjects().count() == 0) {
			wocomponent.setDgActif(dg);
			NSDictionary bdgs = dg.queryBindings();
			String mst = (String) bdgs.valueForKey("diplome");
			if (mst == null) {
				mst = (String) bdgs.valueForKey("prdDiplome");
			}
			if (mst != null && mst.equals("MST")) {
				lesEtudiants = EOIndividu.EtudiantsMST(edc, bdgs, null);
			} else {
				lesEtudiants = EOIndividu.EtudiantsNonMST(edc, bdgs, null);
			}
			wocomponent.getDgActif().setObjectArray(lesEtudiants);
			wocomponent.getDgActif().setCurrentBatchIndex(
					sess.getCurrentBatchIndex());
		} else {
			wocomponent.setDgActif(dg);
			wocomponent.getDgActif().setCurrentBatchIndex(
					sess.getCurrentBatchIndex());
		}
		searchPage = wocomponent.pageWithName("Recherche");
		return searchPage;
	}

	public void letudiant() {
		if (dg == null) {
			dg = new WODisplayGroup();
			dg.setObjectArray(new NSArray(sess.getEtudiant()));
			dg.queryBindings().setObjectForKey(sess.getEtudiant().primaryKey(),
					"numero");
		}
		id = Integer.valueOf(sess.getEtudiant().primaryKey());
		bdgs = dg.queryBindings();
		try {
			NSMutableDictionary etuDico = new NSMutableDictionary();
			etuDico = (NSMutableDictionary) ProcessGestionEtudiant
					.selectRawRowEtudiants(edc, bdgs).lastObject();
			reWriteDico(etuDico);
			wocomponent.setDicEtudiant(etuDico);
		} catch (FactoryException e) {
			String alertMessage = e.getMessageFormatte();
			if (e.isBloquant()) {
				if (e.isInformatif()) {
					// Exception contenant un message d'information pour
					// l'utilisateur
					sess.addSimpleErrorMessage(
							"message d'information pour l'utilisateur",
							alertMessage);
					sess.setMessageErreur(alertMessage);
				} else {
					e.printStackTrace();
					throw e;
				}
			} else {
				sess.addSimpleErrorMessage("FactoryException ", alertMessage);
				sess.setMessageErreur(alertMessage);
			}

		} catch (RuntimeException e1) {
			sess.addSimpleErrorMessage("RuntimeException ", e1.getMessage());
			sess.setMessageErreur(e1.getMessage());
			e1.printStackTrace();
			throw e1;
		}
	}

	public void edtUvSelection() {
		// 6380
		if (dg == null) {
			dg = new WODisplayGroup();
			dg.setObjectArray(new NSArray(sess.getEtudiant()));
			dg.queryBindings().setObjectForKey(sess.getEtudiant().primaryKey(),
					"numero");
		}
		bdgs = dg.queryBindings();
		try {
			NSMutableArray uvList = new NSMutableArray();
			uvList = reWriteListDico(gestEdt.selectRawRowFunctionEdtUV(edc,
					bdgs));
			wocomponent.setListUv(uvList);
		} catch (FactoryException e) {
			String alertMessage = e.getMessageFormatte();
			if (e.isBloquant()) {
				if (e.isInformatif()) {
					// Exception contenant un message d'information pour
					// l'utilisateur
					sess.addSimpleErrorMessage(
							"message d'information pour l'utilisateur",
							alertMessage);
					sess.setMessageErreur(alertMessage);
				} else {
					e.printStackTrace();
					throw e;
				}
			} else {
				sess.addSimpleErrorMessage("FactoryException ", alertMessage);
				sess.setMessageErreur(alertMessage);
			}

		} catch (RuntimeException e1) {
			sess.addSimpleErrorMessage("RuntimeException ", e1.getMessage());
			sess.setMessageErreur(e1.getMessage());
			e1.printStackTrace();
			throw e1;
		}
	}

	public void lesCouleurs(NSArray uvs) {
		for (int i = 0; i < uvs.count(); i++) {
			NSMutableDictionary tmpUv = new NSMutableDictionary();
			tmpUv = (NSMutableDictionary) uvs.objectAtIndex(i);
			couleur.put(tmpUv.valueForKey("UV"), couleurs.objectAtIndex(i));
		}
	}

	public void horaires() {
		edt = wocomponent.getEdtUtil().horaires();
	}

	// Refonte de l'emploi du temps
	public void edtIdSelection1() {
		data = new NSMutableDictionary();
		html = "<!-- Début du HTML--> \n";
		if (dg == null) {
			dg = new WODisplayGroup();
			dg.setObjectArray(new NSArray(sess.getEtudiant()));
			dg.queryBindings().setObjectForKey(sess.getEtudiant().primaryKey(),
					"numero");
		}
		nom = sess.getEtudiant().nomAndPrenom();
		id = Integer.valueOf(sess.getEtudiant().primaryKey());
		bdgs = dg.queryBindings();
		try {
			NSMutableArray edtEtuList = new NSMutableArray();
			edtEtuList = reWriteListDico(gestEdt.selectRawRowFunctionEdt(edc,
					bdgs));
			for (int i = 0; i < edtEtuList.count(); i++) {
				NSMutableDictionary dicoJour = new NSMutableDictionary();
				NSMutableDictionary dicoDebut = new NSMutableDictionary();
				NSMutableDictionary ln = new NSMutableDictionary();
				ln = (NSMutableDictionary) edtEtuList.objectAtIndex(i);
				String jour = (String) ln.objectForKey("JOUR");
				// On vérifie si le dictionnaire principal contient les jours de
				// la semaine
				if (!data.containsKey(jour)) {
					data.put(jour, dicoJour);
				}
				NSMutableDictionary debut = (NSMutableDictionary) data
						.valueForKey(jour);
				Integer deb = wocomponent.getEdtUtil().code((String) ln.objectForKey("DEBUT"));
				// On vérifie si les jours de la semaine ont un numéro de début
				if (!debut.containsKey(deb)) {
					debut.put(deb, dicoDebut);
					NSMutableArray debList = new NSMutableArray();
					NSMutableDictionary edtData = new NSMutableDictionary();
					edtData.put("uv", ln.objectForKey("UV"));
					edtData.put("id", ln.objectForKey("EDT_ID"));
					edtData.put("type", ln.objectForKey("TYPE_EDT"));
					edtData.put("semaine", ln.objectForKey("SEMAINE"));
					edtData.put("weekname", ln.objectForKey("WEEKNAME"));
					edtData.put("salle", ln.objectForKey("SALLE1"));
					Integer fin = wocomponent.getEdtUtil().code((String) ln.objectForKey("FIN"));
					Integer debInt = wocomponent.getEdtUtil().code((String) ln.objectForKey("DEBUT"));
					edtData.put("temp", (fin - debInt));
					debList.addObject(edtData);
					debut.put(deb, debList);
				} else {
					NSMutableArray List = new NSMutableArray();
					NSMutableArray old = (NSMutableArray) debut
							.objectForKey(deb);
					NSMutableDictionary oldDico = (NSMutableDictionary) old
							.objectAtIndex(0);
					NSMutableDictionary edtData = new NSMutableDictionary();
					edtData.put("uv", ln.objectForKey("UV"));
					edtData.put("id", ln.objectForKey("EDT_ID"));
					edtData.put("type", ln.objectForKey("TYPE_EDT"));
					edtData.put("semaine", ln.objectForKey("SEMAINE"));
					edtData.put("weekname", ln.objectForKey("WEEKNAME"));
					edtData.put("salle", ln.objectForKey("SALLE1"));
					Integer fin = wocomponent.getEdtUtil().code((String) ln.objectForKey("FIN"));
					Integer debInt = wocomponent.getEdtUtil().code((String) ln.objectForKey("DEBUT"));
					edtData.put("temp", (fin - debInt));
					List.addObject(oldDico);
					List.addObject(edtData);
					debut.put(deb, List);
				}
			}
			// On parcour chaque jour de la semaine
			for(String jour : jours) {
				html += "<td class=\"jourField\"> \n";
				// Pour le jour on va parcourir les heures qui sont codé en demi
				// heures !
				for (int time = 16; time < 45; time++) {
					html += "<!-- Début for principale--> \n";
					// On recupère le jour
					NSMutableDictionary data_jour = (NSMutableDictionary) data
							.objectForKey(jour);
					NSMutableArray jourTime = null;
					if (data_jour != null) {
						// On récupère les heures du jour
						jourTime = (NSMutableArray) data_jour
								.objectForKey(time);
					}
					// Si il y a un truc qui correspond au moment on va pouvoir
					// l'afficher !
					if (jourTime != null) {
						// la variable max est la fin du mode T2
						Integer max = 0;
						// Analyse de la longeur du T2
						NSMutableDictionary jourTime_T2 = jourTime_T2 = (NSMutableDictionary) jourTime
								.objectAtIndex(0);
						String semaine = (String) jourTime_T2
								.objectForKey("semaine");
						if (semaine != null && semaine.equals("2")) {// IF [SEMAINET2?]
							Integer temp = (Integer) jourTime_T2
									.objectForKey("temp");
							max = temp + time;
							for (int test = time; test < max; test++) {
								NSMutableArray jourTest = (NSMutableArray) data_jour.objectForKey(test);
								if (jourTest != null) {
									NSMutableDictionary jourTest_T2 = null;
									// SI on trouve un creno paralelle on regarde sa taille et on MAJ max
									if(jourTest.count() > 1)
										jourTest_T2 = (NSMutableDictionary) jourTest.objectAtIndex(1);
									if (jourTest_T2 != null) {// On verifie l'existance
										Integer tempa = (Integer) ((NSMutableDictionary) jourTest.objectAtIndex(1)).objectForKey("temp");
										max = Math.max(max,(test+ tempa));
									}
									Integer tempo = (Integer) ((NSMutableDictionary) jourTest.objectAtIndex(0)).objectForKey("temp");
									max = Math.max(max.intValue(), (test + tempo));
									if (jourTest_T2 != null) {// On verifie l'existance
										Integer tempa = (Integer) ((NSMutableDictionary) jourTest.objectAtIndex(1)).objectForKey("temp");
										max = Math.max(max,(test+ tempa));
									}
								}
							}
							//On va maintenant parcourir a gauche puis a drouite le T2
							Integer droite = time;
							html += "<table class=\"tableinner\"><tr><td> \n";
							html += "<!-- debut colonne gauche--> \n";
							//GAUCHE
							for(time = time; time < max; time++) {
								NSMutableArray jourGauche = (NSMutableArray) data_jour.objectForKey(time);
								NSMutableDictionary jourGauche_T2 = null;
								if(jourGauche != null && jourGauche.count() != 0)
									jourGauche_T2 = (NSMutableDictionary) jourGauche.objectAtIndex(0);
								if(jourGauche_T2 != null){
									Integer depile = time;
									html+= wocomponent.getEdtUtil().crenoPlein(jourGauche_T2, jour, time);
									time = wocomponent.getEdtUtil().getIniTime();
									//ARRET ICI
									jourGauche.removeObjectAtIndex(0);
									data_jour.setObjectForKey(jourGauche, depile);
								} else {
									//crenoVide
									html += wocomponent.getEdtUtil().crenoVide("2");
								}	
							}
							html += "<!-- fin colonne gauche--> \n";
							html += "</td><td> \n";
							html += "<!-- debut colonne droite--> \n";
							//DROITE
							for(time = droite; time < max; time++){
								NSMutableArray jourDroite = (NSMutableArray) data_jour.objectForKey(time);
								NSMutableDictionary jourDroite_T2A = null;
								NSMutableDictionary jourDroite_T2B = null;
								if(jourDroite != null && jourDroite.count() != 0){
									jourDroite_T2A = (NSMutableDictionary) jourDroite.objectAtIndex(0);
									if(jourDroite.count() > 1)
										jourDroite_T2B = (NSMutableDictionary) jourDroite.objectAtIndex(1);
								}
								if(jourDroite_T2A != null){
									html+= wocomponent.getEdtUtil().crenoPlein(jourDroite_T2A, jour, time);
									time = wocomponent.getEdtUtil().getIniTime();
								} else if(jourDroite_T2B != null) {
									html+= wocomponent.getEdtUtil().crenoPlein(jourDroite_T2B, jour, time);
									time = wocomponent.getEdtUtil().getIniTime();
								} else {
									//crenoVide
									html += wocomponent.getEdtUtil().crenoVide("2");
								}
							}
							html += "<!-- fin colonne droite--> \n";
							html += "</td></tr></table> \n";
							time = max - 1;
							//Ce else correspond a si il n'y a pas de T2 (mode : normal)
						} else {
							// crenoPlein
							html+= wocomponent.getEdtUtil().crenoPlein(jourTime_T2, jour, time);
							time = wocomponent.getEdtUtil().getIniTime();
						}// FIN de si il y a un creno de semaine T2
					} else {
						// crenoVide
						NSMutableDictionary valueData = null;
						String classe = null;
						String sem = "1";
						Integer tep = 0;
						if (jourTime != null) {
							valueData = (NSMutableDictionary) jourTime.objectAtIndex(0);
							sem = (String) valueData.objectForKey("semaine");
						}
						html += wocomponent.getEdtUtil().crenoVide(sem);
					}// Fin du IF qui verifie qui il y a un creno ou non (le cas
						// au dessus est un else )
				}// FIn du for qui parcour les heures !!!
					// Fin for principal
				html += "<!-- Fin for principal--> \n";
				html += "</td> \n";
			}
			edt.put("html", html);
			// NSLog.out.appendln("page HTML :" + edt.objectForKey("html"));
			// NSLog.out.appendln("page TIME :" + edt.objectForKey("time"));
			horaire = (NSMutableArray) edt.objectForKey("time");
			leHTML = (String) edt.objectForKey("html");
		} catch (FactoryException e) {
			String alertMessage = e.getMessageFormatte();
			if (e.isBloquant()) {
				if (e.isInformatif()) {
					// Exception contenant un message d'information pour
					// l'utilisateur
					sess.addSimpleErrorMessage(
							"message d'information pour l'utilisateur",
							alertMessage);
					sess.setMessageErreur(alertMessage);
				} else {
					e.printStackTrace();
					throw e;
				}
			} else {
				sess.addSimpleErrorMessage("FactoryException ", alertMessage);
				sess.setMessageErreur(alertMessage);
			}

		} catch (RuntimeException e1) {
			sess.addSimpleErrorMessage("RuntimeException ", e1.getMessage());
			sess.setMessageErreur(e1.getMessage());
			e1.printStackTrace();
			throw e1;
		}
	}

	public void edtIdSelection() {
		data = new NSMutableDictionary();
		html = "<!-- Début du HTML--> \n";
		// 6380
		if (dg == null) {
			dg = new WODisplayGroup();
			dg.setObjectArray(new NSArray(sess.getEtudiant()));
			dg.queryBindings().setObjectForKey(sess.getEtudiant().primaryKey(),
					"numero");
		}
		nom = sess.getEtudiant().nomAndPrenom();
		// prenom = sess.getEtudiant().prenom();
		id = Integer.valueOf(sess.getEtudiant().primaryKey());
		bdgs = dg.queryBindings();
		try {
			NSMutableArray edtEtuList = new NSMutableArray();
			edtEtuList = reWriteListDico(gestEdt.selectRawRowFunctionEdt(edc,
					bdgs));
			for (int i = 0; i < edtEtuList.count(); i++) {
				NSMutableDictionary dicoJour = new NSMutableDictionary();
				NSMutableDictionary dicoDebut = new NSMutableDictionary();
				NSMutableDictionary ln = new NSMutableDictionary();
				ln = (NSMutableDictionary) edtEtuList.objectAtIndex(i);
				String jour = (String) ln.objectForKey("JOUR");
				// On vérifie si le dictionnaire principal contient les jours de
				// la semaine
				if (!data.containsKey(jour)) {
					data.put(jour, dicoJour);
				}
				NSMutableDictionary debut = (NSMutableDictionary) data
						.valueForKey(jour);
				Integer deb = code((String) ln.objectForKey("DEBUT"));
				// On vérifie si les jours de la semaine ont un numéro de début
				if (!debut.containsKey(deb)) {
					debut.put(deb, dicoDebut);
					NSMutableArray debList = new NSMutableArray();
					NSMutableDictionary edtData = new NSMutableDictionary();
					edtData.put("uv", ln.objectForKey("UV"));
					edtData.put("id", ln.objectForKey("EDT_ID"));
					edtData.put("type", ln.objectForKey("TYPE_EDT"));
					edtData.put("semaine", ln.objectForKey("SEMAINE"));
					edtData.put("weekname", ln.objectForKey("WEEKNAME"));
					edtData.put("salle", ln.objectForKey("SALLE1"));
					Integer fin = code((String) ln.objectForKey("FIN"));
					Integer debInt = code((String) ln.objectForKey("DEBUT"));
					edtData.put("temp", (fin - debInt));
					debList.addObject(edtData);
					debut.put(deb, debList);
					// NSLog.out.appendln("Contenu du Dico : Data[" + jour +
					// "]["+ deb + "]=" + debut.objectForKey(deb));
				} else {
					NSMutableArray List = new NSMutableArray();
					NSMutableArray old = (NSMutableArray) debut
							.objectForKey(deb);
					NSMutableDictionary oldDico = (NSMutableDictionary) old
							.objectAtIndex(0);
					NSMutableDictionary edtData = new NSMutableDictionary();
					edtData.put("uv", ln.objectForKey("UV"));
					edtData.put("id", ln.objectForKey("EDT_ID"));
					edtData.put("type", ln.objectForKey("TYPE_EDT"));
					edtData.put("semaine", ln.objectForKey("SEMAINE"));
					edtData.put("weekname", ln.objectForKey("WEEKNAME"));
					edtData.put("salle", ln.objectForKey("SALLE1"));
					Integer fin = code((String) ln.objectForKey("FIN"));
					Integer debInt = code((String) ln.objectForKey("DEBUT"));
					edtData.put("temp", (fin - debInt));
					List.addObject(oldDico);
					List.addObject(edtData);
					debut.put(deb, List);
					// NSLog.out.appendln("Contenu du Dico : Data[" + jour +
					// "]["+ deb + "]=" + debut.objectForKey(deb));
				}
			}
			// NSLog.out.appendln("Dico Total :" + data);
			// On parcour chaque jour de la semaine
			for (int j = 0; j < jours.count(); j++) {
				html += "<td class=\"jourField\"> \n";
				String jr = (String) jours.objectAtIndex(j);
				int i = 16;
				// While principal
				while (i < 45) {
					html += "<!-- Début While principal--> \n";
					NSMutableDictionary data_jour = (NSMutableDictionary) data
							.objectForKey(jr);
					NSMutableArray jour_i = null;
					if (data_jour != null) {
						jour_i = (NSMutableArray) data_jour.objectForKey(i);
					}
					// Contenir les décalage
					boolean decalage = false;
					if (jour_i != null && jour_i.count() > 1) {
						decalage = true;
					}
					// Si il y a un truc qui correspond au moment on va pouvoir
					// l'afficher !
					if (data.containsKey(jr)
							&& (data_jour != null && data_jour.containsKey(i))
							&& jour_i != null) {
						Integer maxi = 0;
						// On verifie quel type d'object l'on recupere
						// (Dicionnaire ou Liste)
						String semaine = "";
						// Boucle FOR Pour les contenus de plus d'un Objet
						for (int x = 0; x < jour_i.count(); x++) {
							NSMutableDictionary jour_i_mardi = null;
							jour_i_mardi = (NSMutableDictionary) jour_i
									.objectAtIndex(x);
							semaine = (String) jour_i_mardi
									.objectForKey("semaine");
							// Semaine = 2
							if (semaine != null && semaine.equals("2")) {
								html += "<!-- iF principal semaine == 2--> \n";
								Integer temp = (Integer) jour_i_mardi
										.objectForKey("temp");
								maxi = Integer.valueOf(temp.intValue() + i);
								Integer tt = Integer.valueOf(i);

								while (tt.intValue() < maxi.intValue()) {
									html += "<!-- While tt--> \n";
									NSMutableArray data_tt = (NSMutableArray) data_jour
											.objectForKey(tt);
									if ((data_jour.containsKey(tt))
											&& (data_tt != null)) {
										if (data_tt.count() == 2) {
											Integer tempa = (Integer) ((NSMutableDictionary) data_tt
													.objectAtIndex(0))
													.objectForKey("temp");
											maxi = Integer
													.valueOf(Math.max(
															maxi.intValue(),
															tt.intValue()
																	+ tempa.intValue()));
										}
										Integer tempa = (Integer) ((NSMutableDictionary) data_tt
												.objectAtIndex(0))
												.objectForKey("temp");
										maxi = Integer.valueOf(Math.max(
												maxi.intValue(), tt.intValue()
														+ tempa.intValue()));

										if (data_tt.count() == 2) {
											Integer temp0 = (Integer) ((NSMutableDictionary) data_tt
													.objectAtIndex(0))
													.objectForKey("temp");
											maxi = Integer
													.valueOf(Math.max(
															maxi.intValue(),
															tt.intValue()
																	+ temp0.intValue()));
										}
									}
									html += "<!-- Fin While tt--> \n";
									tt++;
								}

								Integer droite = Integer.valueOf(i);
								html += "<table class=\"tableinner\"><tr><td> \n";
								html += "<!-- colonne gauche--> \n";
								Integer ii = Integer.valueOf(i);
								while (ii.intValue() < maxi.intValue()) {
									NSMutableArray data_jour_ii = (NSMutableArray) data_jour
											.objectForKey(ii);
									// Correction java.lang.NullPointerException
									if (data_jour_ii != null
											&& data_jour_ii.count() != 0) {
										String classeii = null;
										String classej = null;
										String types = null;
										String week = null;
										String tpl = null;
										String tplAB = null;
										NSMutableDictionary valueData_jour_ii = null;
										valueData_jour_ii = (NSMutableDictionary) data_jour_ii
												.objectAtIndex(0);
										if ((data_jour.containsKey(ii))
												&& (data_jour_ii != null)
												&& (valueData_jour_ii != null)) {
											Integer depile = ii;
											Integer temp_ii = (Integer) valueData_jour_ii
													.objectForKey("temp");
											Integer h = Integer.valueOf(temp_ii
													.intValue()
													* HEIGHT.intValue()
													+ temp_ii.intValue() - 2);

											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2"))
												WEIGHT = Integer.valueOf(48);
											else {
												WEIGHT = Integer.valueOf(100);
											}
											types = (String) type
													.objectForKey(valueData_jour_ii
															.objectForKey("type"));
											week = "";
											String weekname = (String) valueData_jour_ii
													.objectForKey("weekname");
											String uvs = (String) valueData_jour_ii
													.objectForKey("uv");
											String coule = (String) couleur
													.objectForKey(uvs);
											String salle = (String) valueData_jour_ii
													.objectForKey("salle");
											cid = ((Number) valueData_jour_ii
													.objectForKey("id"));
											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2")) {
												week = "<br/>" + weekname;
											}
											wei = WEIGHT;
											hei = h;
											col = coule;
											uv = uvs;
											tipe = types;
											sale = salle;
											weak = week;
											tplPlein = ("\n<div class=\"crenoPlein\" style=\"width:"
													+ wei
													+ "px;height:"
													+ hei
													+ "px;background-color:"
													+ col
													+ ";border:1px solid #225588\"> \n"
													+ "<div style=\"height:"
													+ hei
													+ "px;width:"
													+ wei
													+ "px\"> \n"
													+ "<a href=#>"
													+ "<!--\"edtetus?id="
													+ id
													+ "&cid="
													+ cid
													+ "\"-->"
													+ uv
													+ "</a>&nbsp;&nbsp; \n"
													+ tipe
													+ "<br/> \n"
													+ sale
													+ "<br/> \n" + weak + "</div></div> \n");
											tpl = tplPlein;
											html += tpl;
											ii = Integer.valueOf(ii.intValue()
													+ temp_ii.intValue() - 1);

											data_jour_ii.removeObjectAtIndex(0);
											data_jour.setObjectForKey(
													data_jour_ii, depile);
										} else {
											if ((data_jour.containsKey(ii))
													&& (data_jour_ii != null)) {
												if (valueData_jour_ii
														.objectForKey("semaine")
														.equals("2")) {
													WEIGHT = Integer
															.valueOf(48);
												}
											}
											WEIGHT = Integer.valueOf(100);

											html = (html + "<!-- case vide "
													+ i + "--> \n");
											wei = this.WEIGHT;
											tplVide = ("<div class=\"crenoVide\" style=\"height:20px;width:"
													+ wei + "px\"></div>");
											html = (html + tplVide + "\n");
										}
									} else {
										// LARGEUR ZERO
										WEIGHT = 100;
										html += "<!-- case vide " + i
												+ "--> \n";
										wei = WEIGHT;
										tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
												+ wei + "px\"></div>";
										html += tplVide + "\n";
									}
									ii++;
								}
								html += "<!-- fin colonne gauche--> \n";
								html += "</td><td> \n";
								html += "<!-- colonne droite--> \n";
								ii = droite;
								while (ii.intValue() < maxi.intValue()) {
									NSMutableArray data_jour_ii = (NSMutableArray) data_jour
											.objectForKey(ii);
									// Correction2 javaNullException
									if ((data_jour_ii != null)
											&& (data_jour_ii.count() != 0)) {
										String classejii = null;
										String classej = null;
										String types = null;
										String week = null;
										String tpl = null;
										NSMutableDictionary valueData_jour_ii = null;
										// Test1
										if ((data_jour.containsKey(ii))
												&& (data_jour_ii != null)
												&& (data_jour_ii.count() == 1)) {
											valueData_jour_ii = (NSMutableDictionary) data_jour_ii
													.objectAtIndex(0);
											Integer depile_jii = ii;
											Integer temp_ii = (Integer) valueData_jour_ii
													.objectForKey("temp");
											Integer h = Integer.valueOf(temp_ii
													.intValue()
													* HEIGHT.intValue()
													+ temp_ii.intValue() - 2);

											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2"))
												WEIGHT = Integer.valueOf(48);
											else {
												WEIGHT = Integer.valueOf(100);
											}
											types = (String) type
													.objectForKey(valueData_jour_ii
															.objectForKey("type"));
											week = "";
											String weekname = (String) valueData_jour_ii
													.objectForKey("weekname");
											String uvs = (String) valueData_jour_ii
													.objectForKey("uv");
											String coule = (String) couleur
													.objectForKey(uvs);
											String salle = (String) valueData_jour_ii
													.objectForKey("salle");
											cid = ((Number) valueData_jour_ii
													.objectForKey("id"));
											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2")) {
												week = "<br/>" + weekname;
											}
											wei = WEIGHT;
											hei = h;
											col = coule;
											uv = uvs;
											tipe = types;
											sale = salle;
											weak = week;
											tplPlein = ("\n<div class=\"crenoPlein\" style=\"width:"
													+ wei
													+ "px;height:"
													+ hei
													+ "px;background-color:"
													+ col
													+ ";border:1px solid #225588\"> \n"
													+ "<div style=\"height:"
													+ hei
													+ "px;width:"
													+ wei
													+ "px\"> \n"
													+ "<a href=#>"
													+ "<!--\"edtetus?id="
													+ id
													+ "&cid="
													+ cid
													+ "\"-->"
													+ uv
													+ "</a>&nbsp;&nbsp; \n"
													+ tipe
													+ "<br/> \n"
													+ sale
													+ "<br/> \n" + weak + "</div></div> \n");
											tpl = tplPlein;
											html += tpl;
											ii = Integer.valueOf(ii.intValue()
													+ temp_ii.intValue() - 1);
											data_jour_ii.removeObjectAtIndex(0);
											data_jour.setObjectForKey(
													data_jour_ii, depile_jii);
										} else if ((data_jour.containsKey(ii))
												&& (data_jour_ii != null)
												&& (data_jour_ii.count() == 2)) {
											valueData_jour_ii = (NSMutableDictionary) data_jour_ii
													.objectAtIndex(1);
											Integer depile_iij = ii;
											Integer temp_iij = (Integer) valueData_jour_ii
													.objectForKey("temp");
											Integer h = Integer
													.valueOf(temp_iij
															.intValue()
															* HEIGHT.intValue()
															+ temp_iij
																	.intValue()
															- 2);
											WEIGHT = Integer.valueOf(48);
											types = (String) type
													.objectForKey(valueData_jour_ii
															.objectForKey("type"));
											week = "";
											String weekname = (String) valueData_jour_ii
													.objectForKey("weekname");
											String uvs = (String) valueData_jour_ii
													.objectForKey("uv");
											String coule = (String) couleur
													.objectForKey(uvs);
											String salle = (String) valueData_jour_ii
													.objectForKey("salle");
											cid = ((Number) valueData_jour_ii
													.objectForKey("id"));
											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2")) {
												week = "<br/>" + weekname;
											}
											wei = WEIGHT;
											hei = h;
											col = coule;
											uv = uvs;
											tipe = types;
											sale = salle;
											weak = week;
											tplPlein = ("\n<div class=\"crenoPlein\" style=\"width:"
													+ wei
													+ "px;height:"
													+ hei
													+ "px;background-color:"
													+ col
													+ ";border:1px solid #225588\"> \n"
													+ "<div style=\"height:"
													+ hei
													+ "px;width:"
													+ wei
													+ "px\"> \n"
													+ "<a href=#>"
													+ "<!--\"edtetus?id="
													+ id
													+ "&cid="
													+ cid
													+ "\"-->"
													+ uv
													+ "</a>&nbsp;&nbsp; \n"
													+ tipe
													+ "<br/> \n"
													+ sale
													+ "<br/> \n" + weak + "</div></div> \n");
											tpl = tplPlein;
											html += tpl;
											ii = Integer.valueOf(ii.intValue()
													+ temp_iij.intValue() - 1);
											data_jour_ii.removeObjectAtIndex(1);
											data_jour.setObjectForKey(
													data_jour_ii, depile_iij);
										} else {
											WEIGHT = Integer.valueOf(48);
											wei = WEIGHT;
											tplVide = ("<div class=\"crenoVide\" style=\"height:20px;width:"
													+ wei + "px\"></div>");
											html = (html + tplVide + "\n");
										}
									} else {
										// LARGEUR ZERO
										WEIGHT = 0;
										html += "<!-- case vide " + i
												+ "--> \n";
										wei = WEIGHT;
										tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
												+ wei + "px\"></div>";
										html += tplVide + "\n";
									}
									ii++;
								}
								html += "<!-- fin colonne droite--> \n";
								html += "</td></tr></table> \n";
								html += "<!-- Fin iF principal semaine == 2--> \n";
								// if (!decalage) {
								i = maxi.intValue() - 1;
								// } else {
								i = maxi.intValue() + 1;
								// }
							}
							// Semaine Différent de 2
							else {
								html += "<!-- iF principal semaine != 2--> \n";
								Integer depile = Integer.valueOf(i);
								NSMutableDictionary valueData_jour_j = null;
								// Correction3 javaNullException
								if (jour_i_mardi != null) {
									valueData_jour_j = jour_i_mardi;
									Integer temp_i = (Integer) valueData_jour_j
											.objectForKey("temp");
									Integer h = Integer.valueOf(temp_i
											.intValue()
											* HEIGHT.intValue()
											+ temp_i.intValue() - 2);
									String semain = (String) valueData_jour_j
											.objectForKey("semaine");
									if (semain.equals("2"))
										WEIGHT = Integer.valueOf(48);
									else {
										WEIGHT = Integer.valueOf(100);
									}
									String types = (String) type
											.objectForKey(valueData_jour_j
													.objectForKey("type"));
									String week = "";
									NSMutableArray weeky = new NSMutableArray();
									weeky.addObject("A");
									weeky.addObject("B");
									String weekname = (String) valueData_jour_j
											.objectForKey("weekname");
									if (weeky.contains(weekname)) {
										week = "<br/>" + weekname;
									}
									String uvs = (String) valueData_jour_j
											.objectForKey("uv");
									String coule = (String) couleur
											.objectForKey(uvs);
									String salle = (String) valueData_jour_j
											.objectForKey("salle");
									cid = ((Number) valueData_jour_j
											.objectForKey("id"));
									wei = WEIGHT;
									hei = h;
									col = coule;
									uv = uvs;
									tipe = types;
									sale = salle;
									weak = week;
									String tpl = null;
									tplPlein = ("\n<div class=\"crenoPlein\" style=\"width:"
											+ wei
											+ "px;height:"
											+ hei
											+ "px;background-color:"
											+ col
											+ ";border:1px solid #225588\"> \n"
											+ "<div style=\"height:"
											+ hei
											+ "px;width:"
											+ wei
											+ "px\"> \n"
											+ "<a href=#>"
											+ "<!--\"edtetus?id="
											+ id
											+ "&cid="
											+ cid
											+ "\"-->"
											+ uv
											+ "</a>&nbsp;&nbsp; \n"
											+ tipe
											+ "<br/> \n"
											+ sale
											+ "<br/> \n"
											+ weak + "</div></div> \n");
									tpl = tplPlein;
									html += tpl;
									i = i + temp_i.intValue() - 1;
									jour_i.removeObjectAtIndex(0);
									data_jour.setObjectForKey(jour_i, depile);
								} else {
									// LARGEUR ZERO
									WEIGHT = 0;
									html += "<!-- case vide " + i + "--> \n";
									wei = WEIGHT;
									tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
											+ wei + "px\"></div>";
									html += tplVide + "\n";
								}
							}
						}
					} else {
						// null while 45
						NSMutableDictionary valueData = null;
						String classe = null;
						String sem = null;
						Integer tep = 0;
						if (jour_i != null) {
							valueData = (NSMutableDictionary) jour_i
									.objectAtIndex(0);
							sem = (String) valueData.objectForKey("semaine");
							tep = (Integer) valueData.objectForKey("temp");
						}
						if (data.containsKey(jr)
								&& (data_jour != null && data_jour
										.containsKey(i)) && sem != null
								&& sem.equals("2")) {
							WEIGHT = 48;
						} else {
							WEIGHT = 100;
						}
						wei = WEIGHT;
						tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
								+ wei + "px\"></div>";
						html += tplVide;
						if (data.containsKey(jr) && data_jour.containsKey(i)) {
							i = (i + tep) - 1;
						}
					}
					i++;
				}
				// Fin while principal
				html += "<!-- Fin While principal--> \n";
				html += "</td> \n";
			}
			edt.put("html", html);
			NSLog.out.appendln("page HTML :" + edt.objectForKey("html"));
			// NSLog.out.appendln("page TIME :" + edt.objectForKey("time"));
			horaire = (NSMutableArray) edt.objectForKey("time");
			leHTML = (String) edt.objectForKey("html");
		} catch (FactoryException e) {
			String alertMessage = e.getMessageFormatte();
			if (e.isBloquant()) {
				if (e.isInformatif()) {
					// Exception contenant un message d'information pour
					// l'utilisateur
					sess.addSimpleErrorMessage(
							"message d'information pour l'utilisateur",
							alertMessage);
					sess.setMessageErreur(alertMessage);
				} else {
					e.printStackTrace();
					throw e;
				}
			} else {
				sess.addSimpleErrorMessage("FactoryException ", alertMessage);
				sess.setMessageErreur(alertMessage);
			}

		} catch (RuntimeException e1) {
			sess.addSimpleErrorMessage("RuntimeException ", e1.getMessage());
			sess.setMessageErreur(e1.getMessage());
			e1.printStackTrace();
			throw e1;
		}

	}

	public void OldedtIdSelection() {
		data = new NSMutableDictionary();
		html = "<!-- Début du HTML--> \n";
		// 6380
		if (dg == null) {
			dg = new WODisplayGroup();
			dg.setObjectArray(new NSArray(sess.getEtudiant()));
			dg.queryBindings().setObjectForKey(sess.getEtudiant().primaryKey(),
					"numero");
		}
		nom = sess.getEtudiant().nomAndPrenom();
		// prenom = sess.getEtudiant().prenom();
		id = Integer.valueOf(sess.getEtudiant().primaryKey());
		bdgs = dg.queryBindings();
		try {
			NSMutableArray edtEtuList = new NSMutableArray();
			edtEtuList = reWriteListDico(gestEdt.selectRawRowFunctionEdt(edc,
					bdgs));
			for (int i = 0; i < edtEtuList.count(); i++) {
				NSMutableDictionary dicoJour = new NSMutableDictionary();
				NSMutableDictionary dicoDebut = new NSMutableDictionary();
				NSMutableDictionary ln = new NSMutableDictionary();
				ln = (NSMutableDictionary) edtEtuList.objectAtIndex(i);
				String jour = (String) ln.objectForKey("JOUR");
				// On vérifie si le dictionnaire principal contient les jours de
				// la semaine
				if (!data.containsKey(jour)) {
					data.put(jour, dicoJour);
				}
				NSMutableDictionary debut = (NSMutableDictionary) data
						.valueForKey(jour);
				Integer deb = code((String) ln.objectForKey("DEBUT"));
				// On vérifie si les jours de la semaine ont un numéro de début
				if (!debut.containsKey(deb)) {
					debut.put(deb, dicoDebut);
					NSMutableArray debList = new NSMutableArray();
					NSMutableDictionary edtData = new NSMutableDictionary();
					edtData.put("uv", ln.objectForKey("UV"));
					edtData.put("id", ln.objectForKey("EDT_ID"));
					edtData.put("type", ln.objectForKey("TYPE_EDT"));
					edtData.put("semaine", ln.objectForKey("SEMAINE"));
					edtData.put("weekname", ln.objectForKey("WEEKNAME"));
					edtData.put("salle", ln.objectForKey("SALLE1"));
					Integer fin = code((String) ln.objectForKey("FIN"));
					Integer debInt = code((String) ln.objectForKey("DEBUT"));
					edtData.put("temp", (fin - debInt));
					debList.addObject(edtData);
					debut.put(deb, debList);
					// NSLog.out.appendln("Contenu du Dico : Data[" + jour +
					// "]["+ deb + "]=" + debut.objectForKey(deb));
				} else {
					NSMutableArray List = new NSMutableArray();
					NSMutableArray old = (NSMutableArray) debut
							.objectForKey(deb);
					NSMutableDictionary oldDico = (NSMutableDictionary) old
							.objectAtIndex(0);
					NSMutableDictionary edtData = new NSMutableDictionary();
					edtData.put("uv", ln.objectForKey("UV"));
					edtData.put("id", ln.objectForKey("EDT_ID"));
					edtData.put("type", ln.objectForKey("TYPE_EDT"));
					edtData.put("semaine", ln.objectForKey("SEMAINE"));
					edtData.put("weekname", ln.objectForKey("WEEKNAME"));
					edtData.put("salle", ln.objectForKey("SALLE1"));
					Integer fin = code((String) ln.objectForKey("FIN"));
					Integer debInt = code((String) ln.objectForKey("DEBUT"));
					edtData.put("temp", (fin - debInt));
					List.addObject(oldDico);
					List.addObject(edtData);
					debut.put(deb, List);
					// NSLog.out.appendln("Contenu du Dico : Data[" + jour +
					// "]["+ deb + "]=" + debut.objectForKey(deb));
				}
			}
			// NSLog.out.appendln("Dico Total :" + data);
			for (int j = 0; j < jours.count(); j++) {
				html += "<td class=\"jourField\"> \n";
				String jr = (String) jours.objectAtIndex(j);
				int i = 16;
				// While principal
				while (i < 45) {
					html += "<!-- Début While principal--> \n";
					NSMutableDictionary data_jour = (NSMutableDictionary) data
							.objectForKey(jr);
					NSMutableArray jour_i = null;
					if (data_jour != null) {
						jour_i = (NSMutableArray) data_jour.objectForKey(i);
					}
					// Contenir les décalage
					boolean decalage = false;
					if (jour_i != null && jour_i.count() > 1) {
						decalage = true;
					}
					if (data.containsKey(jr)
							&& (data_jour != null && data_jour.containsKey(i))
							&& jour_i != null) {
						Integer maxi = 0;
						// On verifie quel type d'object l'on recupere
						// (Dicionnaire ou Liste)
						String semaine = "";
						// Verification du nombre de dictionnaire contenant dans
						// jour_i
						/*
						 * if (jour_i.count() < 2) { semaine = (String)
						 * ((NSMutableDictionary) jour_i
						 * .objectAtIndex(0)).objectForKey("semaine"); // iF
						 * principal semaine == 2 if (semaine.equals("2")) {
						 * html += "<!-- iF principal semaine == 2--> \n";
						 * Integer temp = (Integer) ((NSMutableDictionary)
						 * jour_i .objectAtIndex(0)).objectForKey("temp"); maxi
						 * = temp + i; Integer tt = i; // While tt while (tt <
						 * maxi) { html += "<!-- While tt--> \n"; NSMutableArray
						 * data_tt = (NSMutableArray) data_jour
						 * .objectForKey(tt); if (data_jour.containsKey(tt) &&
						 * data_tt != null) { if ((((NSMutableArray)
						 * data_tt).count()) == 2) { Integer tempa = (Integer)
						 * ((NSMutableDictionary) data_tt .objectAtIndex(1))
						 * .objectForKey("temp"); maxi = Math.max(maxi, (tt +
						 * tempa)); }
						 * 
						 * Integer tempa = (Integer) ((NSMutableDictionary)
						 * data_tt .objectAtIndex(0)) .objectForKey("temp");
						 * maxi = Math.max(maxi, (tt + tempa));
						 * 
						 * if ((((NSMutableArray) data_tt).count()) == 2) {
						 * Integer temp0 = (Integer) ((NSMutableDictionary)
						 * data_tt .objectAtIndex(1)) .objectForKey("temp");
						 * maxi = Math.max(maxi, (tt + temp0)); } } tt++; } //
						 * Fin while tt Integer droite = i; html +=
						 * "<table class=\"tableinner\"><tr><td> \n"; html +=
						 * "<!-- colonne gauche 1--> \n"; // colonne de gauche 1
						 * Integer ii = i; while (ii < maxi) { NSMutableArray
						 * data_jour_ii = (NSMutableArray) data_jour
						 * .objectForKey(ii); // Correction nullPointerException
						 * if (data_jour_ii != null && data_jour_ii.count() !=
						 * 0) { String classeii = null; String classej = null;
						 * String types = null; String week = null; String tpl =
						 * null; NSMutableArray weeky = new NSMutableArray();
						 * weeky.addObject("A"); weeky.addObject("B");
						 * NSMutableDictionary valueData_jour_ii = null;
						 * //Correction suite à relecture du python gauche 1 if
						 * (data_jour.containsKey(ii) && data_jour_ii != null &&
						 * data_jour_ii.count() == 1) { valueData_jour_ii =
						 * (NSMutableDictionary) data_jour_ii.objectAtIndex(0);
						 * Integer depile = ii; Integer temp_ii = (Integer)
						 * valueData_jour_ii .objectForKey("temp"); Integer h =
						 * temp_ii * HEIGHT + temp_ii - 2; if
						 * (valueData_jour_ii.objectForKey(
						 * "semaine").equals("2")) { WEIGHT = 48; } else {
						 * WEIGHT = 100; } types = (String) type
						 * .objectForKey(valueData_jour_ii
						 * .objectForKey("type")); week = ""; String weekname =
						 * (String) valueData_jour_ii .objectForKey("weekname");
						 * String uvs = (String) valueData_jour_ii
						 * .objectForKey("uv"); String coule = (String) couleur
						 * .objectForKey(uvs); String salle = (String)
						 * valueData_jour_ii .objectForKey("salle"); cid =
						 * (Number) valueData_jour_ii .objectForKey("id"); if
						 * (weeky.contains(weekname)) { week = "<br/>" +
						 * weekname; } wei = WEIGHT; hei = h; col = coule; uv =
						 * uvs; tipe = types; sale = salle; weak = week;
						 * tplPlein =
						 * "\n<div class=\"crenoPlein\" style=\"width:" + wei +
						 * "px;height:" + hei + "px;background-color:" + col +
						 * ";border:1px solid #225588\"> \n" +
						 * "<div style=\"height:" + hei + "px;width:" + wei +
						 * "px\"> \n" + "<a href=#>" + "<!--\"edtetus?id=" + id
						 * + "&cid=" + cid + "\"-->" + uv +
						 * "</a>&nbsp;&nbsp; \n" + tipe + "<br/> \n" + sale +
						 * "<br/> \n" + weak + "</div></div> \n"; tpl =
						 * tplPlein; html += tpl; ii = (ii + temp_ii) - 1; //
						 * Suppression des données // utilisées
						 * data_jour_ii.removeObjectAtIndex(0);
						 * data_jour.setObjectForKey( data_jour_ii, depile); }
						 * else { valueData_jour_ii = (NSMutableDictionary)
						 * data_jour_ii.objectAtIndex(0); if
						 * (data_jour.containsKey(ii) && data_jour_ii != null &&
						 * valueData_jour_ii .objectForKey( "semaine")
						 * .equals("2")) { WEIGHT = 48; } else { WEIGHT = 100; }
						 * html += "<!-- case vide " + i + "--> \n"; wei =
						 * WEIGHT; tplVide =
						 * "<div class=\"crenoVide\" style=\"height:20px;width:"
						 * + wei + "px\"></div>"; html += tplVide + "\n"; } }
						 * else { // LARGEUR ZERO WEIGHT = 0; html +=
						 * "<!-- case vide " + i + "--> \n"; wei = WEIGHT;
						 * tplVide =
						 * "<div class=\"crenoVide\" style=\"height:20px;width:"
						 * + wei + "px\"></div>"; html += tplVide + "\n"; }
						 * ii++; } // Fin colonne gauche 1 html +=
						 * "</td><td> \n"; html +=
						 * "<!-- colonne droite 1--> \n"; // Colonne droite 1 ii
						 * = droite; while (ii < maxi) { NSMutableArray
						 * data_jour_ii = (NSMutableArray) data_jour
						 * .objectForKey(ii); // Correction nullPointerException
						 * if (data_jour_ii != null && data_jour_ii.count() !=
						 * 0) { String classejii = null; String classej = null;
						 * String types = null; String week = null; String tpl =
						 * null; NSMutableArray weeky = new NSMutableArray();
						 * weeky.addObject("A"); weeky.addObject("B");
						 * NSMutableDictionary valueData_jour_ii = null;
						 * valueData_jour_ii = (NSMutableDictionary)
						 * data_jour_ii.objectAtIndex(0); //Correction suite
						 * relecture du python - droite 1 if
						 * (data_jour.containsKey(ii) && data_jour_ii != null &&
						 * valueData_jour_ii != null) { Integer depile_jii = ii;
						 * Integer temp_ii = (Integer) valueData_jour_ii
						 * .objectForKey("temp"); Integer h = temp_ii * HEIGHT +
						 * temp_ii - 2; if (valueData_jour_ii.objectForKey(
						 * "semaine").equals("2")) { WEIGHT = 48; } else {
						 * WEIGHT = 100; } types = (String) type
						 * .objectForKey(valueData_jour_ii
						 * .objectForKey("type")); week = ""; String weekname =
						 * (String) valueData_jour_ii .objectForKey("weekname");
						 * String uvs = (String) valueData_jour_ii
						 * .objectForKey("uv"); String coule = (String) couleur
						 * .objectForKey(uvs); String salle = (String)
						 * valueData_jour_ii .objectForKey("salle"); cid =
						 * (Number) valueData_jour_ii .objectForKey("id"); if
						 * (weeky.contains(weekname)) { week = "<br/>" +
						 * weekname; } wei = WEIGHT; hei = h; col = coule; uv =
						 * uvs; tipe = types; sale = salle; weak = week;
						 * tplPlein =
						 * "\n<div class=\"crenoPlein\" style=\"width:" + wei +
						 * "px;height:" + hei + "px;background-color:" + col +
						 * ";border:1px solid #225588\"> \n" +
						 * "<div style=\"height:" + hei + "px;width:" + wei +
						 * "px\"> \n" + "<a href=#>" + "<!--\"edtetus?id=" + id
						 * + "&cid=" + cid + "\"-->" + uv +
						 * "</a>&nbsp;&nbsp; \n" + tipe + "<br/> \n" + sale +
						 * "<br/> \n" + weak + "</div></div> \n"; tpl =
						 * tplPlein; html += tpl; ii = (ii + temp_ii) - 1;
						 * data_jour_ii.removeObjectAtIndex(0);
						 * data_jour.setObjectForKey( data_jour_ii, depile_jii);
						 * } else if (data_jour.containsKey(ii) && data_jour_ii
						 * != null && data_jour_ii.count() == 2) {
						 * valueData_jour_ii = (NSMutableDictionary)
						 * data_jour_ii .objectAtIndex(1); Integer depile_iij =
						 * ii; Integer temp_iij = (Integer) valueData_jour_ii
						 * .objectForKey("temp"); Integer h = temp_iij * HEIGHT
						 * + temp_iij - 2; WEIGHT = 48; types = (String) type
						 * .objectForKey(valueData_jour_ii
						 * .objectForKey("type")); week = ""; String weekname =
						 * (String) valueData_jour_ii .objectForKey("weekname");
						 * String uvs = (String) valueData_jour_ii
						 * .objectForKey("uv"); String coule = (String) couleur
						 * .objectForKey(uvs); String salle = (String)
						 * valueData_jour_ii .objectForKey("salle"); cid =
						 * (Number) valueData_jour_ii .objectForKey("id"); if
						 * (weeky.contains(weekname)) { week = "<br/>" +
						 * weekname; } wei = WEIGHT; hei = h; col = coule; uv =
						 * uvs; tipe = types; sale = salle; weak = week;
						 * tplPlein =
						 * "\n<div class=\"crenoPlein\" style=\"width:" + wei +
						 * "px;height:" + hei + "px;background-color:" + col +
						 * ";border:1px solid #225588\"> \n" +
						 * "<div style=\"height:" + hei + "px;width:" + wei +
						 * "px\"> \n" + "<a href=#>" + "<!--\"edtetus?id=" + id
						 * + "&cid=" + cid + "\"-->" + uv +
						 * "</a>&nbsp;&nbsp; \n" + tipe + "<br/> \n" + sale +
						 * "<br/> \n" + weak + "</div></div> \n"; tpl =
						 * tplPlein; html += tpl; ii = (ii + temp_iij) - 1;
						 * data_jour_ii.removeObjectAtIndex(1);
						 * data_jour.setObjectForKey( data_jour_ii, depile_iij);
						 * } else { WEIGHT = 48; wei = WEIGHT; tplVide =
						 * "<div class=\"crenoVide\" style=\"height:20px;width:"
						 * + wei + "px\"></div>"; html += tplVide + "\n"; } }
						 * else { // LARGEUR ZERO WEIGHT = 0; html +=
						 * "<!-- case vide " + i + "--> \n"; wei = WEIGHT;
						 * tplVide =
						 * "<div class=\"crenoVide\" style=\"height:20px;width:"
						 * + wei + "px\"></div>"; html += tplVide + "\n"; }
						 * ii=ii+1; } // Fin colonne droite html +=
						 * "</td></tr></table> \n"; html +=
						 * "<!--Fin iF principal semaine == 2--> \n"; i = maxi -
						 * 1; // Fin if principal semaine ==2 } else { html +=
						 * "<!-- iF principal semaine != 2--> \n"; Integer
						 * depile = i; NSMutableDictionary valueData_jour_j =
						 * null; valueData_jour_j = (NSMutableDictionary) jour_i
						 * .objectAtIndex(0); Integer temp_i = (Integer)
						 * valueData_jour_j .objectForKey("temp"); Integer h =
						 * temp_i * HEIGHT + temp_i - 2; String semain =
						 * (String) valueData_jour_j .objectForKey("semaine");
						 * if (semain.equals("2")) { WEIGHT = 48; } else {
						 * WEIGHT = 100; } String types = (String) type
						 * .objectForKey(valueData_jour_j
						 * .objectForKey("type")); String week = "";
						 * NSMutableArray weeky = new NSMutableArray();
						 * weeky.addObject("A"); weeky.addObject("B"); String
						 * weekname = (String) valueData_jour_j
						 * .objectForKey("weekname"); if
						 * (weeky.contains(weekname)) { week = "<br/>" +
						 * weekname; } String uvs = (String) valueData_jour_j
						 * .objectForKey("uv"); String coule = (String) couleur
						 * .objectForKey(uvs); String salle = (String)
						 * valueData_jour_j .objectForKey("salle"); cid =
						 * (Number) valueData_jour_j .objectForKey("id"); wei =
						 * WEIGHT; hei = h; col = coule; uv = uvs; tipe = types;
						 * sale = salle; weak = week; String tpl = null;
						 * tplPlein =
						 * "\n<div class=\"crenoPlein\" style=\"width:" + wei +
						 * "px;height:" + hei + "px;background-color:" + col +
						 * ";border:1px solid #225588\"> \n" +
						 * "<div style=\"height:" + hei + "px;width:" + wei +
						 * "px\"> \n" + "<a href=#>" + "<!--\"edtetus?id=" + id
						 * + "&cid=" + cid + "\"-->" + uv +
						 * "</a>&nbsp;&nbsp; \n" + tipe + "<br/> \n" + sale +
						 * "<br/> \n" + weak + "</div></div> \n"; tpl =
						 * tplPlein; html += tpl; i = (i + temp_i) - 1;
						 * jour_i.removeObjectAtIndex(0);
						 * data_jour.setObjectForKey(jour_i, depile);
						 * 
						 * } } else {
						 */
						for (int x = 0; x < jour_i.count(); x++) {
							NSMutableDictionary jour_i_mardi = new NSMutableDictionary();
							// Vérification index X
							jour_i_mardi = (NSMutableDictionary) jour_i
									.objectAtIndex(x);
							semaine = (String) jour_i_mardi
									.objectForKey("semaine");
							// iF principal semaine == 2
							if (semaine.equals("2")) {
								html += "<!-- iF2 principal semaine == 2--> \n";
								Integer temp = (Integer) jour_i_mardi
										.objectForKey("temp");
								maxi = temp + i;
								Integer tt = i;
								// While tt
								while (tt < maxi) {
									html += "<!-- While tt2--> \n";
									NSMutableArray data_tt = (NSMutableArray) data_jour
											.objectForKey(tt);
									if (data_jour.containsKey(tt)
											&& data_tt != null) {
										if (data_tt.count() == 2) {
											Integer tempa = (Integer) ((NSMutableDictionary) data_tt
													.objectAtIndex(0))
													.objectForKey("temp");
											maxi = Math.max(maxi, (tt + tempa));
										}
										Integer temp0 = (Integer) ((NSMutableDictionary) data_tt
												.objectAtIndex(0))
												.objectForKey("temp");
										maxi = Math.max(maxi, (tt + temp0));

										if (data_tt.count() == 2) {
											Integer temp1 = (Integer) ((NSMutableDictionary) data_tt
													.objectAtIndex(0))
													.objectForKey("temp");
											maxi = Math.max(maxi, (tt + temp1));
										}
									}
									tt++;
								}
								// Fin while tt
								Integer droite = i;
								html += "<table class=\"tableinner\"><tr><td> \n";
								html += "<!-- colonne gauche 2--> \n";
								// colonne de gauche 2
								Integer ii = i;
								while (ii < maxi) {
									NSMutableArray data_jour_ii = (NSMutableArray) data_jour
											.objectForKey(ii);
									// Correction nullPointerException
									if (data_jour_ii != null
											&& data_jour_ii.count() != 0) {
										String classeii = null;
										String classej = null;
										String types = null;
										String week = null;
										String tpl = null;
										String tplAB = null;
										NSMutableArray weeky = new NSMutableArray();
										weeky.addObject("A");
										weeky.addObject("B");
										NSMutableDictionary valueData_jour_ii = null;
										valueData_jour_ii = (NSMutableDictionary) data_jour_ii
												.objectAtIndex(0);
										if (data_jour.containsKey(ii)
												&& data_jour_ii != null
												&& valueData_jour_ii != null) {
											Integer depile = ii;
											Integer temp_ii = (Integer) valueData_jour_ii
													.objectForKey("temp");
											Integer h = ((temp_ii * HEIGHT) + temp_ii) - 2;
											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2")) {
												WEIGHT = 48;
											} else {
												WEIGHT = 100;
											}
											types = (String) type
													.objectForKey(valueData_jour_ii
															.objectForKey("type"));
											week = "";
											String weekname = (String) valueData_jour_ii
													.objectForKey("weekname");
											String uvs = (String) valueData_jour_ii
													.objectForKey("uv");
											String coule = (String) couleur
													.objectForKey(uvs);
											String salle = (String) valueData_jour_ii
													.objectForKey("salle");
											cid = (Number) valueData_jour_ii
													.objectForKey("id");
											if (weeky.contains(weekname)) {
												week = "<br/>" + weekname;
											}
											wei = WEIGHT;
											hei = h;
											col = coule;
											uv = uvs;
											tipe = types;
											sale = salle;
											weak = week;
											tplPlein = "\n<div class=\"crenoPlein\" style=\"width:"
													+ wei
													+ "px;height:"
													+ hei
													+ "px;background-color:"
													+ col
													+ ";border:1px solid #225588\"> \n"
													+ "<div style=\"height:"
													+ hei
													+ "px;width:"
													+ wei
													+ "px\"> \n"
													+ "<a href=#>"
													+ "<!--\"edtetus?id="
													+ id
													+ "&cid="
													+ cid
													+ "\"-->"
													+ uv
													+ "</a>&nbsp;&nbsp; \n"
													+ tipe
													+ "<br/> \n"
													+ sale
													+ "<br/> \n"
													+ weak
													+ "</div></div> \n";
											tpl = tplPlein;
											html += tpl;
											if (weeky.contains(weekname)) {
												tplAB = "";
												tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
														+ 0 + "px\"></div>";
												tplAB += tplVide + "\n";
												tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
														+ 0 + "px\"></div>";
												tplAB += tplVide + "\n";
												html += tplAB;
											}
											ii = (ii + temp_ii) - 1;
											// Suppression des données
											// utilisées
											data_jour_ii.removeObjectAtIndex(0);
											data_jour.setObjectForKey(
													data_jour_ii, depile);

										} else {
											if (data_jour.containsKey(ii)
													&& data_jour_ii != null
													&& valueData_jour_ii
															.objectForKey(
																	"semaine")
															.equals("2")) {
												WEIGHT = 48;
											} else {
												WEIGHT = 100;
											}
											html += "<!-- case vide " + i
													+ "--> \n";
											wei = WEIGHT;
											tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
													+ wei + "px\"></div>";
											html += tplVide + "\n";
										}
									} else {
										// LARGEUR ZERO
										WEIGHT = 0;
										html += "<!-- case vide " + i
												+ "--> \n";
										wei = WEIGHT;
										tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
												+ wei + "px\"></div>";
										html += tplVide + "\n";
									}
									ii++;
								}
								// Fin colonne gauche 2
								html += "</td><td> \n";
								html += "<!-- colonne droite 2--> \n";
								// Colonne droite 2
								ii = droite;
								while (ii < maxi) {
									NSMutableArray data_jour_ii = (NSMutableArray) data_jour
											.objectForKey(ii);
									// Correction nullPointerException
									if (data_jour_ii != null
											&& data_jour_ii.count() != 0) {
										String classejii = null;
										String classej = null;
										String types = null;
										String week = null;
										String tpl = null;
										NSMutableArray weeky = new NSMutableArray();
										weeky.addObject("A");
										weeky.addObject("B");
										NSMutableDictionary valueData_jour_ii = null;
										if (data_jour_ii != null
												&& data_jour_ii.count() != 0) {
											valueData_jour_ii = (NSMutableDictionary) data_jour_ii
													.objectAtIndex(0);
										}
										if (data_jour.containsKey(ii)
												&& data_jour_ii != null
												&& valueData_jour_ii != null) {
											Integer depile_jii = ii;
											Integer temp_ii = (Integer) valueData_jour_ii
													.objectForKey("temp");
											Integer h = temp_ii * HEIGHT
													+ temp_ii - 2;
											if (valueData_jour_ii.objectForKey(
													"semaine").equals("2")) {
												WEIGHT = 48;
											} else {
												WEIGHT = 100;
											}
											types = (String) type
													.objectForKey(valueData_jour_ii
															.objectForKey("type"));
											week = "";
											String weekname = (String) valueData_jour_ii
													.objectForKey("weekname");
											String uvs = (String) valueData_jour_ii
													.objectForKey("uv");
											String coule = (String) couleur
													.objectForKey(uvs);
											String salle = (String) valueData_jour_ii
													.objectForKey("salle");
											cid = (Number) valueData_jour_ii
													.objectForKey("id");
											if (weeky.contains(weekname)) {
												week = "<br/>" + weekname;
											}
											wei = WEIGHT;
											hei = h;
											col = coule;
											uv = uvs;
											tipe = types;
											sale = salle;
											weak = week;
											tplPlein = "\n<div class=\"crenoPlein\" style=\"width:"
													+ wei
													+ "px;height:"
													+ hei
													+ "px;background-color:"
													+ col
													+ ";border:1px solid #225588\"> \n"
													+ "<div style=\"height:"
													+ hei
													+ "px;width:"
													+ wei
													+ "px\"> \n"
													+ "<a href=#>"
													+ "<!--\"edtetus?id="
													+ id
													+ "&cid="
													+ cid
													+ "\"-->"
													+ uv
													+ "</a>&nbsp;&nbsp; \n"
													+ tipe
													+ "<br/> \n"
													+ sale
													+ "<br/> \n"
													+ weak
													+ "</div></div> \n";
											tpl = tplPlein;
											html += tpl;
											ii = (ii + temp_ii) - 1;
											data_jour_ii.removeObjectAtIndex(0);
											data_jour.setObjectForKey(
													data_jour_ii, depile_jii);
										} else if (data_jour.containsKey(ii)
												&& data_jour_ii != null
												&& data_jour_ii.count() == 2) {
											valueData_jour_ii = (NSMutableDictionary) data_jour_ii
													.objectAtIndex(1);
											Integer depile_iij = ii;
											Integer temp_iij = (Integer) valueData_jour_ii
													.objectForKey("temp");
											Integer h = temp_iij * HEIGHT
													+ temp_iij - 2;
											WEIGHT = 48;
											types = (String) type
													.objectForKey(valueData_jour_ii
															.objectForKey("type"));
											week = "";
											String weekname = (String) valueData_jour_ii
													.objectForKey("weekname");
											String uvs = (String) valueData_jour_ii
													.objectForKey("uv");
											String coule = (String) couleur
													.objectForKey(uvs);
											String salle = (String) valueData_jour_ii
													.objectForKey("salle");
											cid = (Number) valueData_jour_ii
													.objectForKey("id");
											if (weeky.contains(weekname)) {
												week = "<br/>" + weekname;
											}
											wei = WEIGHT;
											hei = h;
											col = coule;
											uv = uvs;
											tipe = types;
											sale = salle;
											weak = week;
											tplPlein = "\n<div class=\"crenoPlein\" style=\"width:"
													+ wei
													+ "px;height:"
													+ hei
													+ "px;background-color:"
													+ col
													+ ";border:1px solid #225588\"> \n"
													+ "<div style=\"height:"
													+ hei
													+ "px;width:"
													+ wei
													+ "px\"> \n"
													+ "<a href=#>"
													+ "<!--\"edtetus?id="
													+ id
													+ "&cid="
													+ cid
													+ "\"-->"
													+ uv
													+ "</a>&nbsp;&nbsp; \n"
													+ tipe
													+ "<br/> \n"
													+ sale
													+ "<br/> \n"
													+ weak
													+ "</div></div> \n";
											tpl = tplPlein;
											html += tpl;
											ii = (ii + temp_iij) - 1;
											data_jour_ii.removeObjectAtIndex(1);
											data_jour.setObjectForKey(
													data_jour_ii, depile_iij);
										} else {
											WEIGHT = 48;
											wei = WEIGHT;
											tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
													+ wei + "px\"></div>";
											html += tplVide + "\n";
										}
									} else {
										// LARGEUR ZERO
										WEIGHT = 0;
										html += "<!-- case vide " + i
												+ "--> \n";
										wei = WEIGHT;
										tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
												+ wei + "px\"></div>";
										html += tplVide + "\n";
									}
									ii++;
								}
								// Fin colonne droite 2
								html += "</td></tr></table> \n";
								html += "<!-- iF2 principal semaine == 2--> \n";
								i = maxi - 1;
								// Fin if principal semaine ==2
							} else {
								html += "<!-- iF2 principal semaine != 2--> \n";
								Integer depile = i;
								NSMutableDictionary valueData_jour_j = null;
								valueData_jour_j = jour_i_mardi;
								if (valueData_jour_j != null) {
									Integer temp_i = (Integer) valueData_jour_j
											.objectForKey("temp");
									Integer h = temp_i * HEIGHT + temp_i - 2;
									String semain = (String) valueData_jour_j
											.objectForKey("semaine");
									if (semain.equals("2")) {
										WEIGHT = 48;
									} else {
										WEIGHT = 100;
									}
									String types = (String) type
											.objectForKey(valueData_jour_j
													.objectForKey("type"));
									String week = "";
									NSMutableArray weeky = new NSMutableArray();
									weeky.addObject("A");
									weeky.addObject("B");
									String weekname = (String) valueData_jour_j
											.objectForKey("weekname");
									if (weeky.contains(weekname)) {
										week = "<br/>" + weekname;
									}
									String uvs = (String) valueData_jour_j
											.objectForKey("uv");
									String coule = (String) couleur
											.objectForKey(uvs);
									String salle = (String) valueData_jour_j
											.objectForKey("salle");
									cid = (Number) valueData_jour_j
											.objectForKey("id");
									wei = WEIGHT;
									hei = h;
									col = coule;
									uv = uvs;
									tipe = types;
									sale = salle;
									weak = week;
									String tpl = null;
									tplPlein = "\n<div class=\"crenoPlein\" style=\"width:"
											+ wei
											+ "px;height:"
											+ hei
											+ "px;background-color:"
											+ col
											+ ";border:1px solid #225588\"> \n"
											+ "<div style=\"height:"
											+ hei
											+ "px;width:"
											+ wei
											+ "px\"> \n"
											+ "<a href=#>"
											+ "<!--\"edtetus?id="
											+ id
											+ "&cid="
											+ cid
											+ "\"-->"
											+ uv
											+ "</a>&nbsp;&nbsp; \n"
											+ tipe
											+ "<br/> \n"
											+ sale
											+ "<br/> \n"
											+ weak + "</div></div> \n";
									tpl = tplPlein;
									html += tpl;
									i = (i + temp_i) - 1;
									// On retire l'objet traiter
									jour_i.removeObjectAtIndex(0);
									data_jour.setObjectForKey(jour_i, depile);
								} else {
									// LARGEUR ZERO
									WEIGHT = 0;
									html += "<!-- case vide " + i + "--> \n";
									wei = WEIGHT;
									tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
											+ wei + "px\"></div>";
									html += tplVide + "\n";
								}

							}
						}
						// }
					} else {
						// null while 45
						NSMutableDictionary valueData = null;
						String classe = null;
						String sem = null;
						Integer tep = 0;
						if (jour_i != null) {
							valueData = (NSMutableDictionary) jour_i
									.objectAtIndex(0);
							sem = (String) valueData.objectForKey("semaine");
							tep = (Integer) valueData.objectForKey("temp");
						}
						if (data.containsKey(jr)
								&& (data_jour != null && data_jour
										.containsKey(i)) && sem != null
								&& sem.equals("2")) {
							WEIGHT = 48;
						} else {
							WEIGHT = 100;
						}
						wei = WEIGHT;
						tplVide = "<div class=\"crenoVide\" style=\"height:20px;width:"
								+ wei + "px\"></div>";
						html += tplVide;
						if (data.containsKey(jr) && data_jour.containsKey(i)) {
							i = (i + tep) - 1;
						}
					}
					i++;
				}
				// Fin while principal
				html += "<!-- Fin While principal--> \n";
				html += "</td> \n";
			}
			edt.put("html", html);
			NSLog.out.appendln("page HTML :" + edt.objectForKey("html"));
			// NSLog.out.appendln("page TIME :" + edt.objectForKey("time"));
			horaire = (NSMutableArray) edt.objectForKey("time");
			leHTML = (String) edt.objectForKey("html");
		} catch (FactoryException e) {
			String alertMessage = e.getMessageFormatte();
			if (e.isBloquant()) {
				if (e.isInformatif()) {
					// Exception contenant un message d'information pour
					// l'utilisateur
					sess.addSimpleErrorMessage(
							"message d'information pour l'utilisateur",
							alertMessage);
					sess.setMessageErreur(alertMessage);
				} else {
					e.printStackTrace();
					throw e;
				}
			} else {
				sess.addSimpleErrorMessage("FactoryException ", alertMessage);
				sess.setMessageErreur(alertMessage);
			}

		} catch (RuntimeException e1) {
			sess.addSimpleErrorMessage("RuntimeException ", e1.getMessage());
			sess.setMessageErreur(e1.getMessage());
			e1.printStackTrace();
			throw e1;
		}
	}

	// Dictionnary Null value decoder
	protected NSMutableArray reWriteListDico(NSArray dicoList) {
		NSMutableArray listDico = new NSMutableArray();
		for (int j = 0; j < dicoList.count(); j++) {
			NSMutableDictionary tinyDico = new NSMutableDictionary();
			tinyDico = (NSMutableDictionary) dicoList.objectAtIndex(j);
			reWriteDico(tinyDico);
			listDico.addObject(tinyDico);
		}
		return listDico;
	}

	protected NSMutableDictionary reWriteDico(NSMutableDictionary dico) {
		NSMutableDictionary ledico = new NSMutableDictionary();
		ledico = dico;
		for (int i = 0; i < dico.size(); i++) {
			String key = (String) dico.allKeys().objectAtIndex(i);
			Object value = dico.valueForKey(key);
			if (value.toString().equals(
					"<com.webobjects.foundation.NSKeyValueCoding$Null>")) {
				dico.setObjectForKey("", key);
				ledico = dico;
			}
		}
		return ledico;
	}

	// Time decoder / coder protected
	String decode(Number ptime) {
		String ttime = null;
		String t = null;
		float time = ptime.floatValue();
		Double var = new Double(time / 2);
		double pf = Math.floor(var);
		if (String.valueOf(pf).length() == 3) {
			ttime = String.valueOf(pf).substring(0, 1) + ":";
		} else {
			ttime = String.valueOf(pf).substring(0, 2) + ":";
		}
		Double var1 = new Double(ptime.doubleValue() / 2);
		if (pf == (var1)) {
			t = "00";
		} else {
			t = "30";
		}
		ttime += t;
		return ttime;
	}

	protected Integer code(String pdebut) {
		String[] one = null;
		Integer more = 0;
		one = pdebut.split(":");
		if (one[1].equals("30")) {
			more = 1;
		}
		if (one[1].equals("60")) {
			more = 2;
		}
		return Integer.valueOf(one[0]) * 2 + more;
	}

	protected void theType() {
		type = new NSMutableDictionary();
		type.put("CM", "Cours");
		type.put("TP", "TP");
		type.put("TD", "TD");

	}

	protected void theDay() {
		jours = new NSMutableArray();
		jours.addObject("lundi");
		jours.addObject("mardi");
		jours.addObject("mercredi");
		jours.addObject("jeudi");
		jours.addObject("vendredi");
		jours.addObject("samedi");
	}

	protected void theColor() {
		couleurs = new NSMutableArray();
		couleurs.addObject("#BBFF00");
		couleurs.addObject("#CCFFCC");
		couleurs.addObject("#FFFFCC");
		couleurs.addObject("#CCAACC");
		couleurs.addObject("#FFAA88");
		couleurs.addObject("#BBCCFF");
		couleurs.addObject("#BBFFBB");
		couleurs.addObject("#00FF00");
		// couleurs.addObject("#BBFF00"); //couleurs.addObject("#CCFFCC");
	}

}
